<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medicine - Amlodipine</title>
</head>
<body>
  <h1>Medicine Page - Amlodipine 5mg Tablet</h1>
  <p id="result">⏳ Checking patient match...</p>

  <script>
    try {
      const linkedPatientId = "P504321"; // Should match patient
      const resultDiv = document.getElementById("result");

      const scannedPatient = localStorage.getItem("scannedPatient");
      const scanTime = localStorage.getItem("scanTime");

      if (!scannedPatient || !scanTime) {
        resultDiv.innerHTML = "❌ Please scan the patient first.";
      } else {
        const now = Date.now();
        const elapsed = now - parseInt(scanTime);

        if (elapsed > 60000) {
          resultDiv.innerHTML = "⌛️ Session expired. Please scan the patient again.";
          localStorage.removeItem("scannedPatient");
          localStorage.removeItem("scanTime");
        } else if (scannedPatient === linkedPatientId) {
          resultDiv.innerHTML = "✅ Match successful! This medicine belongs to the patient.";
        } else {
          resultDiv.innerHTML = "⚠️ Mismatch: This medicine does not belong to the patient.";
        }
      }
    } catch (err) {
      document.getElementById("result").innerHTML = "❌ Error: " + err.message;
    }
  </script>
</body>
</html>
